# Тестовое задание - Обрезаненко В С
### Описание файлов
R_test.ipynb - юпитер ноутбук с кодом и шагами решения.
geno_matrix.csv - обработанный файл vcf в формате матрицы.
gwas_results_with_coordinates.csv - результаты GWAS анализа.
phenotypes.csv - урожайность клеточных линий.
test_data.gds - обработанный vcf файл в формате gds для анализа.

## Предобработка
В vcf файле содержатся данные 153 клеточных линий. Оставляем биаллельные снипы - 11587. Для анализа оставляем только те, для которых есть данные по урожайности - 99. Для считывания используется библиотека SNPRelate.
  
## GWAS анализ
GWAS-анализ выполнен вручную с помощью линейной регрессии lm() из базового пакета R. Для каждого SNP рассчитывалась регрессия фенотипа на генотип, извлекались бета-оценка и p-value.
![image](https://github.com/user-attachments/assets/ff982d15-9c3b-44ed-84c5-21410ff4ad39)   
![image](https://github.com/user-attachments/assets/97cd2b82-f401-4f13-969c-610548538fe4)  

GWAS-анализ выявил несколько значимых SNP-ассоциаций с фенотипом (урожайностью), наиболее сильные сигналы обнаружены на хромосомах 5, 7 и 15, особенно в регионах 17.5–18.5 Mb на хромосоме 7, где p-value достигают порядка 10⁻⁹. Эти участки могут содержать гены-кандидаты, влияющие на урожайность.
  
![image](https://github.com/user-attachments/assets/23753381-959a-424b-922e-bbd55836cd40)  

## Модель предсказания  

Модель предсказания была построена с использованием линейной регрессии с L2-регуляризацией (RidgeCV) на Python с помощью библиотек pandas, scikit-learn и KNNImputer для обработки пропущенных генотипических значений (здесь для улучшения модели можно рассмотреть разные варианты заполнения пропусков). В качестве предикторов использовались только SNP с p-value < 0.01 из GWAS, а итоговая точность модели составила R² = 0.517 и RMSE = 8.419, что говорит о среднем уровне объяснённой вариативности фенотипа. 

![image](https://github.com/user-attachments/assets/488eb5aa-7ebf-477b-9f1a-a59175124a0d)

  
![image](https://github.com/user-attachments/assets/2df915e1-278b-4134-b391-8d7aad50405d)  

Было проведено сравнение нескольких моделей машинного обучения: RidgeCV, линейной регрессии, дерева решений и градиентного бустинга. По результатам оценки по метрикам R² и RMSE, модель RidgeCV показала наилучшее качество предсказания. 
Для дальнейшего повышения точности модели можно использовать более строгую фильтрацию SNP по значимости GWAS (как вариант, если не будет слишком большого отсева), добавить внешние данные (например, погодные или почвенные условия), а также протестировать ансамбли моделей или методы отбора признаков (подбор гиперпараметров).

## Дополнительное задание

Для улучшения предсказательной точности модели можно интегрировать погодные и почвенные данные, привязав их к каждой линии по месту и году испытания. Из погодных условий можно извлечь агрегированные признаки, такие как средняя температура, сумма осадков, количество солнечных дней за вегетационный период. Данные о почве можно преобразовать в признаки pH, содержание органики, текстуру. Эти переменные добавляются в таблицу фенотипов и используются как дополнительные входы для модели.
Если у нас много климатических параметров за разные фазы роста, можно создавать новые признаки, комбинируя их между собой.


Автоматизация анализа может быть реализована с помощью пайплайнов, например, с использованием Snakemake или Nextflow. Это позволит стандартизировать процесс от загрузки и очистки данных, через GWAS и обработку матриц, до обучения и валидации моделей.

